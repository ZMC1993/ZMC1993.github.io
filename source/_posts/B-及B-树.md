---
title: B-及B+树
date: 2019-03-07 20:48:56
tags:
---
## 一、B-树
* 1.1 概述
数据库的索引都是使用树结构来存储的，因为树的查询效率高，而且可以保持有序。
二叉搜索树的查找速度和比较次数都是最小的。
但数据库索引是存储在磁盘上的，数据量比较大时，索引的大小可能有几个G甚至更多，而利用索引查询时，只能逐一加载每一个磁盘页，磁盘页对应着索引树的节点。
如果使用二叉搜索树的话，在最坏的情况下磁盘IO的次数是索引树的高度，为减少磁盘IO的次数就要尽量降低树的高度。
* 1.2 B-树的定义
B树是一种多路平衡查找树，每个节点最多包含k个孩子，k称为B树的阶，k的大小取决于磁盘页的大小。
一个m阶的B树包含如下特征：
（1）根节点至少有两个子女
（2）每个中间节点都包含k-1个元素和k个孩子，其中m/2<=k<=m
（3）每一个叶子节点都包含k-1个元素，其中m/2<=k<=m
（4）所有的叶子节点都位于同一层
（5）每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域划分。
B-树的查询次数并不比二叉查找树少，尤其是当单一节点中的元素数量很多时，但内存中比较耗时基本可以忽略不计，所以只要IO次数足够少就可以提高查询性能。
B-树的插入和删除操作比较复杂，但这两个操作能实现自平衡。
* 1.3 应用 
B-树主要用于文件系统以及部分数据库索引，比如MongoDB。

## 二、B+树
* 2.1 概述
B+树是基于B-树的一种变体，比B-树查询性能更高
* 2.2 B+树的定义
B+树除拥有B-树的定义外，一个m阶的B+树还有以下特征：
（1）有k个子树的中间节点包含有k个元素（B-树中是k-1个元素），每个元素不保存数据，只用来索引，所有数据都保存在叶子节点
（2）所有的叶子节点中包含了全部元素的信息，以及指向这些元素记录的指针，且叶子节点本身依据关键字的大小自小到大的顺序链接
（3）所有的中间元素节点都同时存在于子节点，在子节点中是最大或最小元素
* 2.3 B+树的特点
根节点的最大元素就是整个B+树的最大元素，每个叶子节点都带有指向下一个节点的指针，形成了一个有序链表。
索引元素所指向的数据记录叫卫星数据，比如数据库中的某一行，在B-树中无论中间节点还是叶子节点都带有卫星数据。
而在B+树中，只有叶子节点带有卫星数据，其余中间节点仅仅是索引，没有任何数据库关联。
在数据库的聚集索引中，叶子节点直接包含卫星数据，在非聚集索引中，叶子节点带有指向卫星数据的指针。
B+树的中间节点没有卫星数据，所以同样大小的磁盘页可以容纳更多的节点元素。
* 2.4 与B-树相比
B-树的查询性能并不稳定，最好情况是到根节点，最坏情况是到叶子节点，B+树的每一次查找都是稳定的。
B-树的范围查询只能靠中序遍历，B+树只需在叶子节点的有序链表上做遍历即可
* 2.5 应用
关系型数据库的索引，如Mysql